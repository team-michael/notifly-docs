---
sidebar_position: 5
---

# Client SDK - Javascript

Notifly Javascript (JS) SDK는 노티플라이를 웹 어플리케이션과 연동하기 위해 사용할 수 있습니다.

```mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
```

## 1. Notifly JS SDK 셋업

웹 어플리케이션의 환경에 따라 다음 방식 중 하나로 JS SDK를 설치 및 초기화 해주세요.

### Option 1. npm / yarn

패키지를 설치하기 위해, 다음을 실행해 주세요:

<Tabs>
<TabItem value="npm" label="npm">

```shell
npm install notifly-js-sdk@latest --save
```

</TabItem>
<TabItem value="yarn" label="yarn">

```shell
yarn add notifly-js-sdk@latest
```

</TabItem>
</Tabs>

설치가 완료되면, `index.js` 또는 `App.js`에서 Notifly SDK 초기화 코드를 추가해 주세요.

`NOTIFLY_PROJECT_ID`, `NOTIFLY_USERNAME`, `NOTIFLY_PASSWORD` 값은 노티플라이 홈페이지의 설정 페이지에서 확인하실 수 있습니다.

```js title="Example ReactJS code for initialization -- index.js, App.js, _app.jsx or equivalent"
import notifly from 'notifly-js-sdk';
...
useEffect(() => {
    if (typeof window !== 'undefined') {
        notifly.initialize(
            process.env.NOTIFLY_PROJECT_ID,
            process.env.NOTIFLY_USERNAME,
            process.env.NOTIFLY_PASSWORD,
        );
    }
}
...
```

### Option 2. Notifly CDN

Notifly SDK를 HTML에 직접적으로 추가해 주시면 비동기적으로 초기화 됩니다.

`NOTIFLY_PROJECT_ID`, `NOTIFLY_USERNAME`, `NOTIFLY_PASSWORD` 값은 노티플라이 홈페이지의 설정 페이지에서 확인하실 수 있습니다.

```html title="Example HTML code for install & initialization"
<script type="text/javascript">
    async function initializeNotifly() {
        const { default: notifly } = await import('https://cdn.notifly.tech/notifly-js-sdk/dist/index.js');
        notifly.initialize(NOTIFLY_PROJECT_ID, NOTIFLY_USERNAME, NOTIFLY_PASSWORD);
        window.notifly = notifly;
    }
    initializeNotifly();
</script>
```

## 2. 유저 프로퍼티 등록하기

- Notifly에서는 유저의 아이디 (userId) 및 프로퍼티 (userProperties)를 설정하여 마케팅 캠페인 집행 시에 활용할 수 있습니다.
  - Notifly에서는 채널 별 푸시 알림 수신 동의 여부를 유저 프로퍼티로 설정하여, 푸시 알림 전송 전에 필터링 할 수 있습니다.
  - Notifly SDK 초기화 코드 추가를 마친 후 프로퍼티 등록을 시작해 주세요.

### 2-1. 유저 아이디 등록

| Parameter | Type   | Required |
| --------- | ------ | -------- |
| userId    | String | Yes      |

```js
notifly.setUserId(userId);
```

<Tabs>
<TabItem value="react" label="ReactJS">

```js title="Example ReactJS code for setUserId"
const handleLogin = () => {
    ...
    notifly.setUserId('example_user_id');
    ...
}

const handleLogout = () => {
    ...
    notifly.setUserId(); // unregister user id
    ...
}
```

</TabItem>
<TabItem value="vanillajs" label="JS">

```js title="Example JS code for setUserId"
userIdSaveButton.addEventListener('click', function () {
    window.notifly.setUserId(userIdInput.value);
});
```

</TabItem>
</Tabs>

### 2-2. 유저 프로퍼티 등록

| Parameter      | Type                | Required |
| -------------- | ------------------- | -------- |
| userProperties | Record<string, any> | Yes      |

```js
notifly.setUserProperties(userProperties);
```

<Tabs>
<TabItem value="react" label="ReactJS">

```js title="Example ReactJS code for setUserProperties"
const handleRejectPushNotification = () => {
    ...
    notifly.setUserProperties({
        "paid_membership": true,
        "subscriptions": ["astro_boy", "x-men"],
    });
    ...
}
```

</TabItem>
<TabItem value="vanillajs" label="JS">

```js title="Example JS code for setUserProperties"
subscribeButton.addEventListener('click', function () {
    ...
    window.notifly.setUserProperties({
        "subscribed": true,
    });
});
```

</TabItem>
</Tabs>

## 3. 이벤트 로깅

- Notifly에서는 유저의 행동 등 이벤트를 트래킹하여 캠페인 집행 시 타겟팅에 활용할 수 있습니다. 트래킹 된 이벤트는 푸시 알림 발송 타이밍, 유저 세그먼트 설정 등에 활용할 수 있습니다.
  - Notifly SDK 초기화 코드 추가를 마친 후 이벤트 로깅을 시작해 주세요.
- segmentationEventParamKeys 활용하여 이벤트 변수 (eventParams의)를 유저 세그먼트 설정 등에 활용할 수 있습니다. 이를 위해서, 유저 세그멘트 설정에 사용할 eventParams의 특정 field의 key 값을 segmentationEventParamKeys 지정해주세요.
  - 현재는 segmentationEventParamKeys 한 개까지 지원하고 있기 때문에, segmentationEventParamKeys 길이는 1이하인 List이어야합니다.

### 3-1. 이벤트 로깅

| Parameter                  | Type                | Required |
| -------------------------- | ------------------- | -------- |
| eventName                  | String              | Yes      |
| eventParams                | Record<string, any> | No       |
| segmentationEventParamKeys | string[]            | No       |

```js
notifly.trackEvent(eventName, eventParams, segmentationEventParamKeys);
```


<Tabs>
<TabItem value="react" label="ReactJS">

```js title="Example ReactJS code for trackEvent"
const handleContentView = () => {
    ...
    notifly.trackEvent("view_content", {
        "content_name": "mickey_mouse",
    });
    ...
}

// Example code with segmentationEventParamKeys
const handlePurchaseTicket = () => {
    ...
    notifly.trackEvent("ticket_purchase", {
        "show_id": "sample_show_id",
        "performance_start_time": 1674104659
    }, ["show_id"]);
    ...
}
```

</TabItem>

<TabItem value="vanillajs" label="JS">

```js title="Example JS code for trackEvent"
event1Button.addEventListener('click', function () {
    ...
    window.notifly.trackEvent('event1');
});
```

</TabItem>

</Tabs>

## 4. (Optional) Firebase 웹 푸시 셋업

웹 앱에서 이미 Firebase Cloud Messaging (FCM)으로 웹 푸시를 발송하고 계셨다면, Notifly에서 FCM을 연동할 수 있습니다. 

다음이 모두 준비되었는지 확인해 주세요.

1. Firebase 프로젝트 셋업이 되어 있어야 푸시 수신이 가능합니다.
    - [Firebase 프로젝트 연동](http://docs.notifly.tech/ko/developer-guide/client-sdk/firebase_project_setup) 을 마친 후, SDK 연동을 시작해주세요.
2. Firebase Cloud Messaging에서 사용하는 token을 Notifly에 등록할 수 있는 준비가 되었는지 확인해 주세요.
3. 푸시를 Foreground 및 Background 상태에서 수신할 수 있는 handler 가 준비되었는지 확인해 주세요.

모두 준비되었다면, 푸시 전송을 위해 Firebase Cloud Messaging의 device token을 Notifly에 등록합니다:

| Parameter   | Type   | Required |
| ----------- | ------ | -------- |
| deviceToken | String | Yes      |

```js
notifly.setDeviceToken(deviceToken);
```

<Tabs>
<TabItem value="react" label="ReactJS">

```js title="Example ReactJS code for setDeviceToken"
useEffect(() => {
  async function initializeFCMToken() {
    try {
      const token = await getFCMToken();
      notifly.setDeviceToken(token);
    } catch (e) {
      console.error(e);
    }
  }
  initializeFCMToken();
}, []);
```

</TabItem>
</Tabs>
